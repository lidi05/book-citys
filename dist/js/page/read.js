define(["jquery","template","base64"],function(e,i){var t=window.localStorage,o=t.getItem("fontSize")||16,c=e(".book-cont"),n=e(".book-mask"),a=e(".menu-dialog");c.css("font-size",o+"px");var s=t.getItem("chapter_id")||1,l=null;function u(){t.setItem("chapter_id",s),e.ajax({url:"/book/reader-list?article="+s,dataType:"json",success:function(o){var n,t,c=o.jsonp;n=c,(t=document.createElement("script")).src=n,window.duokan_fiction_chapter=function(o){var o=JSON.parse(e.base64().decode(o));e(".book-cont").empty(),i(e(".readCont").html(),o,".book-cont");var n=l.length;e(".f_top_num").html(s+"/"+n),document.head.removeChild(t)},document.head.appendChild(t)}})}function r(o){var n=parseInt(c.css("font-size"));c.css("font-size",n+o),t.setItem("fontSize",n+o)}e.ajax({url:"/book/menu-list",dataType:"json",async:!1,success:function(o){l=o.item.toc}}),u(),c.on("click",function(){n.show()}),n.on("click",function(){n.hide()}),e(".menu-btn").on("click",function(o){o.stopPropagation(),i(e(".menulist").html(),{list:l},".menu-dialog ul"),a.addClass("show")}),e(".menu-dialog").on("click","li",function(){s=e(this).data("id"),u(),a.removeClass("show")}),e(".prev-btn").on("click",function(o){if(o.stopPropagation(),--s<=0)return!1;u()}),e(".next-btn").on("click",function(o){if(o.stopPropagation(),++s>l.length)return!1;u()}),e(".back").on("click",function(){e(".menu-dialog ul").empty(),a.removeClass("show")}),e(".backg-btn").on("click",function(o){o.stopPropagation(),e(".book-cont").css("background-color","skyblue")}),e(".font-btn").on("click",function(o){o.stopPropagation(),e(".font-dialog").show()}),e(".big-btn").on("click",function(o){o.stopPropagation(),r(2)}),e(".samll-btn").on("click",function(o){o.stopPropagation(),r(-2)})});